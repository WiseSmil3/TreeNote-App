<!DOCTYPE html>
<html>
<head>
  <style>
    /* Your styles here */
  </style>
</head>
<body>
  <div id="root"></div>
  <div id="controls">
    <button onclick="createRootNoteBlock()">Add Root Note</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
  <script>
    const firebaseConfig = {
      /* Your Firebase configuration here */
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    async function loadNotes() {
      const snapshot = await db.collection("notes").get();
      const notes = snapshot.docs.map(doc => ({id: doc.id, data: doc.data()}));
      notes.forEach(note => createNoteBlock(note.data.title, document.getElementById("root"), note.id));
    }

    async function createRootNoteBlock() {
      const noteText = prompt("Enter your note:");
      const docRef = await db.collection("notes").add({title: noteText || "New note"});
      createNoteBlock(noteText || "New note", document.getElementById("root"), docRef.id);
    }

    function createNoteBlock(noteText, parentElement, id) {
      const noteBlock = document.createElement("div");
      noteBlock.id = id;
      noteBlock.classList.add("node");
      noteBlock.innerHTML = `
        <div class="button-container">
          <button onclick="event.stopPropagation(); createNewNoteBlock(this.parentNode.parentNode);">+</button>
          <button onclick="event.stopPropagation(); deleteNoteBlock('${id}');">x</button>
        </div>
        <div class="note-title" contenteditable="true" onkeydown="handleTitleKeydown(event)" onpaste="handleTitlePaste(event)" onblur="updateTitle('${id}', this.textContent)"><span>${noteText}</span></div>
        <div class="note-content" contenteditable="true" onblur="updateContent('${id}', this.textContent)"></div>
        <div class="children"></div>
      `;

      parentElement.appendChild(noteBlock);
    }

    async function deleteNoteBlock(id) {
      await db.collection("notes").doc(id).delete();
      document.getElementById(id).remove();
    }

    async function updateTitle(id, newTitle) {
      await db.collection("notes").doc(id).update({title: newTitle});
    }

    async function updateContent(id, newContent) {
      await db.collection("notes").doc(id).update({content: newContent});
    }

    // Call the loadNotes function when the page loads
    window.onload = loadNotes;
  </script>
</body>
</html>
